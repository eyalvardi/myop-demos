import"./chunk-4CLCTAJ7.js";var Z=Object.defineProperty,ke=Object.defineProperties,Oe=Object.getOwnPropertyDescriptors,j=Object.getOwnPropertySymbols,Le=Object.prototype.hasOwnProperty,Pe=Object.prototype.propertyIsEnumerable,B=(e,s,t)=>s in e?Z(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,f=(e,s)=>{for(var t in s||(s={}))Le.call(s,t)&&B(e,t,s[t]);if(j)for(var t of j(s))Pe.call(s,t)&&B(e,t,s[t]);return e},H=(e,s)=>ke(e,Oe(s)),$e=(e,s)=>{for(var t in s)Z(e,t,{get:s[t],enumerable:!0})},r=(e,s,t)=>B(e,typeof s!="symbol"?s+"":s,t),m=(e,s,t)=>new Promise((n,i)=>{var o=d=>{try{l(t.next(d))}catch(c){i(c)}},a=d=>{try{l(t.throw(d))}catch(c){i(c)}},l=d=>d.done?n(d.value):Promise.resolve(d.value).then(o,a);l((t=t.apply(e,s)).next())}),k="__federation__",X="onLoad",Y=(e,s)=>{window[k]&&window[k][e]&&window[k][e][X]&&window[k][e][X]({[e]:s})},h={InitRequest:"InitRequest",InitResponse:"InitResponse",InitMessage:"InitMessage",DisposeMessage:"DisposeMessage",ChangeTextMessage:"ChangeTextMessage",BindClickMessage:"BindClickMessage",DetectMyopRefsMessage:"DetectMyopRefsMessage",ExecuteScriptMessage:"ExecuteScriptMessage",AddEventListenerMessage:"AddEventListenerMessage",SetAttributeMessage:"SetAttributeMessage",CreateRefComponentMessage:"CreateRefComponentMessage",EnvelopedMessage:"EnvelopedMessage",GetElementValueMessage:"GetElementValueMessage",GetAttributeMessage:"GetAttributeMessage",ExecuteComponentMethod:"ExecuteComponentMethod",SetMutationObserverMessage:"SetMutationObserverMessage",SetResizeObserverMessage:"SetResizeObserverMessage",CleanupMessage:"CleanupMessage",In:{DetectedMyopRefsMessage:"DetectedMyopRefsMessage",ClickReplayMessage:"ClickReplayMessage",ExecuteScriptReplyMessage:"ExecuteScriptReplyMessage",EventListenerCallbackMessage:"EventListenerCallbackMessage",ElementValueReplayMessage:"ElementValueReplayMessage",GetAttributeReplayMessage:"GetAttributeReplayMessage",RefComponentCreatedMessage:"RefComponentCreatedMessage",EnvelopedMessage:"EnvelopedMessage",MutationObserverMessage:"MutationObserverMessage",CleanupReplayMessage:"CleanupReplayMessage",ResizeObserverMessage:"ResizeObserverMessage"}},K={};$e(K,{AddEventListenerMessage:()=>Ne,BaseMyopMessage:()=>g,BindClickMessage:()=>Ke,ChangeTextMessage:()=>Fe,CleanupMessage:()=>Me,CleanupReplayMessage:()=>we,ClickReplayMessage:()=>se,CreateRefComponentMessage:()=>pe,CustomRefMessage:()=>F,DetectMyopRefsMessage:()=>Ge,DetectedMyopRefsMessage:()=>ge,DisposeMessage:()=>Ee,ElementValueReplayMessage:()=>de,EnvelopedMessage:()=>me,EventListenerCallbackMessage:()=>ae,ExecuteComponentMethod:()=>E,ExecuteScriptMessage:()=>x,ExecuteScriptReplyMessage:()=>re,GetAttributeMessage:()=>Ve,GetAttributeReplayMessage:()=>je,GetElementValueMessage:()=>Ue,InitMessage:()=>N,InitRequest:()=>ue,InitResponse:()=>ce,MessageDirection:()=>v,MutationObserverMessage:()=>Je,MyopBindMessage:()=>w,MyopBindReplayMessage:()=>M,MyopElementMessage:()=>Be,Ref:()=>R,RefComponentCreatedMessage:()=>q,ResizeObserverMessage:()=>Ze,SetAttributeMessage:()=>We,SetMutationObserverMessage:()=>Xe,SetResizeObserverMessage:()=>Qe,stripFunction:()=>ie});var _=()=>"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(+e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>+e/4).toString(16)),Ae=e=>new Promise(s=>setTimeout(s,e)),v=class{};r(v,"down","down");r(v,"up","up");var g=class{constructor(){r(this,"id",_()),r(this,"myop",!0),r(this,"content"),r(this,"source"),r(this,"destination"),r(this,"route"),r(this,"ref"),r(this,"direction"),r(this,"cleanable",!1)}static create(...e){return new this(...e)}isTypeof(e){return e.messageType===this.messageType}},Be=class extends g{constructor(e){super(),this.ref=e}},M=class extends g{constructor(e){super(),this.replayToHandler=e}},w=class extends g{constructor(e){super(),this.handler=e,r(this,"handlerUniqueId",_())}},R=class ee{constructor(s,t){this.refConfig=s,this.component=t,r(this,"myop",!0),r(this,"__nonProxied"),this.__nonProxied=H(f({},this),{component:null})}static create(s,t,n){let i=t;return i||(i={id:"",name:"",description:"",selectorType:"id-attribute",selector:s,behavior:{type:"code"}}),new ee(i,n)}},te="ClickReplayMessage",Ke=class extends w{constructor(e,s){super(s),this.ref=e,r(this,"replyMessageKey",te),r(this,"messageType","BindClickMessage"),r(this,"cleanable",!0)}},se=class extends M{constructor(){super(...arguments),r(this,"messageType",te)}},Fe=class extends g{constructor(e,s){super(),this.ref=e,r(this,"messageType","ChangeTextMessage"),this.content=s}},ne="ExecuteScriptReplyMessage",qe=/(?:function\s*\w*\s*\([^)]*\)\s*\{([\s\S]*?)\}|(\([^)]*\)\s*=>\s*\{([\s\S]*?)\}))\s*$/,ze=/\(\s*[^)]+\s*\)\s*=>\s*(.+)/,ie=e=>{let s=e.match(qe);if(s)return s[1]||s[3];{let t=e.match(ze);if(t)return t[1].trim()}},x=class extends w{constructor(e,s=()=>{},t){super(s),this.scriptInputs=t,r(this,"replyMessageKey",ne),r(this,"messageType","ExecuteScriptMessage"),r(this,"script",""),this.script=e.toString(),this.content=e.toString(),this.content=ie(this.content)}};r(x,"replierKey","send");r(x,"completeStreamKey","completeStream");var re=class extends M{constructor(e,s){super(e),this.replayToHandler=e,this.content=s,r(this,"messageType",ne)}},F=class extends x{constructor(e,s,t=()=>{}){super(({rootRef:n,elementId:i,_script:o,__scriptInputs:a})=>{let l=(n.shadowRoot||n.container).querySelectorAll(`[myop-id='${i}']`);return l.length?(a.ref=l[0],new Function(`return (${o})(...arguments)`)(a)):null},t),this.scriptInputs=s,this.scriptInputs=H(f({},s),{_script:e.toString()})}},oe="EventListenerCallbackMessage",Ne=class extends w{constructor(e,s,t){super(t),this.ref=e,this.type=s,this.handler=t,r(this,"replyMessageKey",oe),r(this,"messageType","AddEventListenerMessage"),r(this,"cleanable",!0),r(this,"serializableSkeleton",!1)}withSerializableSkeleton(e){return this.serializableSkeleton=e,this}},ae=class extends M{constructor(e,s){super(e),this.replayToHandler=e,this.e=s,r(this,"messageType",oe),this.content={e:s}}},We=class extends g{constructor(e,s,t){super(),this.ref=e,this.name=s,this.value=t,r(this,"messageType","SetAttributeMessage")}},le="ElementValueReplayMessage",Ue=class extends w{constructor(e,s){super(s),this.ref=e,r(this,"replyMessageKey",le),r(this,"messageType","GetElementValueMessage")}},de=class extends M{constructor(e){super(),this.content=e,r(this,"messageType",le)}},N=class extends g{constructor(e){super(),r(this,"messageType","InitMessage"),this.content={id:e}}isTypeof(e){return e.messageType===this.messageType}},ce=class extends N{constructor(){super(...arguments),r(this,"messageType","InitResponse")}},ue=class extends g{constructor(){super(...arguments),r(this,"messageType","InitRequest")}},he="RefComponentCreatedMessage",pe=class extends w{constructor(e,s,t,n){super(n),this.refConfig=e,this.nestedComponentConfig=s,this.options=t,r(this,"replyMessageKey",he),r(this,"messageType","CreateRefComponentMessage")}},q=class extends M{constructor(e,s,t){super(e),this.replayToHandler=e,this.nestedRefs=s,this.failed=t,r(this,"messageType",he)}},me=class extends g{constructor(e,s){super(),this.destination=e,this.message=s,r(this,"messageType","EnvelopedMessage");let t=s;this.route=[e,...t.route?t.route:[]]}},fe="DetectedMyopRefsMessage",Ge=class extends w{constructor(){super(...arguments),r(this,"messageType","DetectMyopRefsMessage"),r(this,"replyMessageKey",fe)}},ge=class extends M{constructor(e,s){super(e),this.replayToHandler=e,r(this,"messageType",fe),this.content=s}isTypeof(e){return e.messageType===this.messageType}},ye="GetAttributeReplayMessage",Ve=class extends w{constructor(e,s,t){super(t),this.ref=e,this.name=s,r(this,"replyMessageKey",ye),r(this,"messageType","GetAttributeMessage")}},je=class extends M{constructor(e){super(),this.content=e,r(this,"messageType",ye)}},E=class extends g{constructor(e){super(),this.method=e,r(this,"messageType","ExecuteComponentMethod")}},Xe=class extends g{constructor(){super(...arguments),r(this,"messageType","SetMutationObserverMessage")}},Je=class extends g{constructor(){super(...arguments),r(this,"messageType","MutationObserverMessage")}},ve="CleanupReplayMessage",Me=class extends w{constructor(e,s){super(s),this.cleanupForMessageId=e,r(this,"replyMessageKey",ve),r(this,"messageType","CleanupMessage")}},we=class extends M{constructor(e){super(),this.customCleanup=e,r(this,"messageType",ve)}},Ee=class extends g{constructor(){super(...arguments),r(this,"messageType","DisposeMessage")}},Qe=class extends g{constructor(){super(...arguments),r(this,"cleanable",!0),r(this,"messageType","SetResizeObserverMessage")}},Ze=class extends g{constructor(){super(...arguments),r(this,"messageType","ResizeObserverMessage")}},W=class{constructor(e,s,t){this.componentDefinition=e,this.container=s,r(this,"id",""),r(this,"messageHandlers",{}),r(this,"element"),r(this,"_markedForDisposed",!1),r(this,"bind",(i,o)=>{this.messageHandlers[i]||(this.messageHandlers[i]=[]),this.messageHandlers[i].includes(o)||this.messageHandlers[i].push(o)}),r(this,"bindWhen",(i,o,a)=>{if(!a)throw new Error("can't use component.bindWhen without an handler");this.messageHandlers[i]||(this.messageHandlers[i]=[]);let l=this.messageHandlers[i],d=c=>o(c)?(a(c),!0):!1;return l.push(d),()=>{let c=l.indexOf(d);c>-1&&l.splice(c,1)}}),r(this,"setInitiated",()=>{this.isInitiated=!0,this._whenInitiatedResolve&&this._whenInitiatedResolve()}),r(this,"isInitiated",!1),r(this,"_whenInitiatedResolve"),r(this,"_whenInitiatedReject"),r(this,"_whenInitiated",new Promise((i,o)=>{this._whenInitiatedResolve=i,this._whenInitiatedReject=o})),r(this,"initiated",()=>this._whenInitiated),r(this,"props",{}),r(this,"refs",{}),this.id=t?.id||P.Instance().assignId(e);let n=t?.timeout?t?.timeout:5*1e3;setTimeout(()=>{!this.isInitiated&&this._whenInitiatedReject&&!this._markedForDisposed&&this._whenInitiatedReject(`timeout_${n}`)},n),this.initiated().then(()=>{window.myop.hostSDK.inspected&&this.inspect()})}get markedForDisposed(){return this._markedForDisposed}set markedForDisposed(e){if(this._markedForDisposed)throw new Error("InvalidOperationException: The component is already in the process of being disposed. Dispose operation cannot be performed again until the current disposal process is complete.");this._markedForDisposed=e}onMessageReceived(e){if(e.messageType===h.ExecuteComponentMethod){let t=e;return this[t.method]?this[t.method]():console.log(`method not found ${t.method} on component`,this),!0}let s=this.messageHandlers[e.messageType];if(s&&s.length){let t=!1;return s.forEach(n=>{t=t||n(e)}),t}return!1}sendCleanupMessage(e){e.source=this.id,e.destination=this.id,e.direction=v.down;let s=this.bindWhen(e.replyMessageKey,n=>n.replayToHandler===e.handlerUniqueId,n=>{e.handler(n),s()}),t=e.handler;delete e.handler,this.send(e),e.handler=t}send(e){e.source||(e.source=this.id),e.destination||(e.destination=this.id),e.direction=v.down;let s;if(e.handler){let t=e;s=this.bindWhen(t.replyMessageKey,n=>n.replayToHandler===t.handlerUniqueId,t.handler),delete e.handler}return e.ref&&(e.ref=e.ref.__nonProxied||e.ref),e.cleanable?()=>{this.sendCleanupMessage(new Me(e.id,t=>{})),s&&s()}:()=>{}}dispose(){if(this.markedForDisposed=!0,!this.isInitiated)return;console.log("disposing component",this.id),this.send(new Ee);let e=this.messageHandlers.onDispose;e&&e.forEach(s=>{s(null)}),this.messageHandlers={},this.id+="_disposed",this.isInitiated=!1}},Ye=class{constructor(e,s,t,n,i){this.myopId=e,this.htmlTagName=s,this.BoundingRect=t,this.offsetTop=n,this.offsetLeft=i,r(this,"type","MyopElementRef")}},et=e=>m(void 0,null,function*(){if(typeof e=="function")e();else if(e instanceof Promise){let s=yield e;typeof s=="function"&&s()}}),tt=class{constructor(e){this.messageToHost=e}},st=class extends tt{constructor(e,s){super(e),this.messageToHost=e,this.context=s}},nt=class{constructor(e,s){this.id=e,this.context=s,r(this,"send",t=>{})}},it=class{constructor(){r(this,"messageToHandleAfterInit",[]),r(this,"components",{}),r(this,"alwaysPassEnvelopesToHost",!1),r(this,"messageCleanupCache",{})}handleIncomeMessages(e){let s=e.data?e.data:e.detail;if(!(!s||!s.myop)){let t=s;if(t.direction!==v.down)return;if(t.messageType===h.DisposeMessage){t.destination&&delete this.components[t.destination];return}if(t.messageType===h.InitMessage){let n=t.content.id;if(this.components[n])return;this.components[n]=new nt(n),this.messageToHost(new ce(n));return}if(t.messageType===h.EnvelopedMessage){let n=t,i=n.message;if(t=i,this.alwaysPassEnvelopesToHost||this.components[t.destination]){let o=myop.hostSDK.components.find(l=>l.id===i.destination);if(o){o.send(i);return}let a=myop.hostSDK.components.find(l=>l.id===n.destination);if(a){a.send(i);return}}else return}if(t.messageType){if(t.messageType===h.CleanupMessage){let i=t,o=this.messageCleanupCache[i.cleanupForMessageId],a=new we(!!o);a.destination=t.destination,o?(delete this.messageCleanupCache[i.cleanupForMessageId],et(o).then(()=>{this.messageToHost(a,i)}).catch(()=>{})):this.messageToHost(a,i);return}let n=!1;this.supportedHandlers.forEach(i=>{if(i.messageType===t.messageType){n=!0;let o=i.executor(t);if(t.cleanable&&o&&(this.messageCleanupCache[t.id]=o),o&&!t.cleanable)throw new Error(`Cleanup handler generated for non-cleanable message. 
messageType - ${t.messageType}, handler executor was - ${i.executor}

Please review the message definition object & message handler.
To ensure cleanup properly set 'cleanable' true at message definition and return IMessageExecutorCleanup from your handlers.`);if(!o&&t.cleanable)throw new Error(`No cleanup handler generated for a cleanable message. 
messageType - ${t.messageType}, handler executor was - ${i.executor}

Please review the message definition object & message handler.
To ensure cleanup properly set 'cleanable' true at message definition and return IMessageExecutorCleanup from your handlers.`)}})}else console.log("unsupported message type")}}},U={IframeLoader:"IframeLoader",WebComponentLoader:"WebComponentLoader",HTMLLoader:"HTMLLoader"},be={open:"open",closed:"closed",none:"none"},G=class{};r(G,"code","code");r(G,"component","component");var $={Segmented:"Segmented",Dedicated:"Dedicated",Default:"Default"},rt={Segment:"Segment",AB:"AB"},ot=class{constructor(e,s){this.container=e,this.shadowRoot=s,r(this,"getRootDiv",()=>(this.shadowRoot||this.container).querySelector("div")),r(this,"getRoot",()=>this.shadowRoot||this.container)}},z=e=>e!==Object(e),at=e=>typeof e=="function",Ce=e=>{if(z(e))return!0;if(at(e)||Object.getPrototypeOf(e))return!1;for(let s in e){let t=e[s];if(typeof t=="object"){if(!Ce(t))return!1}else{if(z(t))continue;return!1}}return!0},I=(e,s={},t=!0,n=new WeakMap)=>{if(z(e))return e;if(Array.isArray(e)){if(n.has(e))return n.get(e);let i=[];n.set(e,i);for(let o=0;o<e.length;o++){let a=e[o];i[o]=I(a,s,t,n)}return i}if(e!==null&&typeof e=="object"){if(n.has(e))return n.get(e);let i={};n.set(e,i);for(let o in e){let a=typeof s=="boolean"?s:s[o];a&&(a===!0?(t?e[o]!==void 0:e[o])&&(i[o]=I(e[o],!0,t,n)):typeof a=="object"&&(i[o]=I(e[o],a,t,n)))}return i}return{}},lt={notSerializableRefCall:(e,s)=>{throw new Error(`
The input provided to '${e.toString()}' is not serializable. Serialization is required to ensure that the data can be safely transferred to the skin implementation. 
The following types of data are considered non-serializable and cannot be processed:

- Functions
- DOM elements
- Class instances
- Circular references
- Symbols
- BigInt values

In the following execution we detected :
~~~~~~~~
${s} 
~~~~~~~~
as not serializable.

To resolve this issue, please ensure that all inputs passed to '${e.toString()}' are in a serializable format.
This typically includes primitive types (strings, numbers, booleans), arrays, and plain objects. 
If you need to include complex data types, consider converting them to a serializable structure before passing them to the function.
Or use Myop message that support it: CustomRefMessage, AddEventListenerMessage or ExecuteScriptMessage.

Suggested Fix:
1. Remove or replace non-serializable values from your input.
2. If using objects, ensure they do not contain any functions or circular references.
3. Convert any class instances to plain objects or JSON-compatible formats.
4. Use dedicated Myop message.

For more details on serialization and Myop message examples, refer to https://docs.myop.dev.

`)}},J=class extends W{constructor(e,s,t){super(e,s.container,t),this.componentDefinition=e,this.parent=s,r(this,"send",n=>{let i=n.handler,o=super.send(n);return this.parent.send(new me(this.id,n)),n.handler=i,o}),r(this,"dispose",()=>{this.isInitiated&&this.send(new E("dispose")),super.dispose()})}hide(){this.send(new E("hide"))}show(){this.send(new E("show"))}inspect(){return this.send(new E("inspect"))}setHeightBasedOnDocumentElement(){this.send(new E("setHeightBasedOnDocumentElement"))}setHeightBasedOnScrollHeight(){this.send(new E("setHeightBasedOnScrollHeight"))}onMessageReceived(e){return super.onMessageReceived(e)}},dt=(e,s,t)=>{let n=document.createElement("a");return n.textContent=e,n.style.position="relative",n.style.padding="0 5px",n.style.fontSize="14px",n.style.top="0",n.style.top=`${s}px`,n.style.transform="translateX(-50%)",n.target="_blank",n.href=`http://localhost:9200/dashboard/component/${t.id}`,n},Ie=(e,s,t,n,i,o)=>{let a=dt(`${e} : ${s}`,t,o);return n.insertBefore(a,i),i.style.border="1px solid #007BFF",i.style.display="block",()=>{i.style.border="unset",n.removeChild(a)}},ct=(e,s)=>{let t=s.reduce((i,o)=>H(f({},i),{[o.name]:f({},o)}),{}),n={get:(i,o)=>{let a=t[o];return a.mode==="output"?new Promise(l=>{let d=[];a.behavior.ref&&d.push(R.create(a.behavior.ref)),d.push(u=>{l(u)}),a.behavior.params&&d.push(...a.behavior.params);let c=K[a.behavior.message];e.send(new c(...d))}):null},set:(i,o,a)=>{let l=t[o];if(!l)throw new Error(`Error: Undefined Prop

It looks like you've tried to use a prop that hasn't been defined.
Please check the prop name for any typos or ensure that it is properly defined in the component's prop list.

Prop Name: ${o}
Component: ${e.componentDefinition.name}, ID: ${e.componentDefinition.id}

For more information, refer to the component page https://dashboard.myop.dev/dashboard/component/${e.componentDefinition.id} or consult the developer guide.`);if(l.mode==="input")if(l.behavior.type==="message"){let d=[];l.behavior.ref&&d.push(R.create(l.behavior.ref)),d.push(a),l.behavior.params&&d.push(...l.behavior.params);let c=K[l.behavior.message];return e.send(new c(...d)),!0}else throw new Error(`Error: Unsupported Behavior

The 'behavior' field provided is not supported.
Component: ${e.componentDefinition.name}, ID: ${e.componentDefinition.id}

Prop Name: ${o}
Behavior Field: ${l.behavior.type}

Check the documentation for valid behavior options.`);return!1}};return e.props={},e.props=new Proxy(e.props,n),e},ut=(e,s)=>new Proxy(e,{get(t,n){return t[n]?t[n]:(...o)=>new Promise(a=>{o.forEach(l=>{Ce(l)||lt.notSerializableRefCall(n,l)}),s.send(new F(({ref:l,propName:d,functionArgs:c,makeSerializable:u})=>{if(l){let p=l[d];return u(typeof p=="function"?l[d](...c):p,!0)}return null},{elementId:t.refConfig.selector,propName:n,functionArgs:o},l=>{a(l.content)}))})},set(t,n,i){return s.send(new F(({ref:o,propName:a,propValue:l})=>{o&&(o[a]=l)},{elementId:t.refConfig.selector,propValue:i,propName:n},o=>{})),!0}}),xe=(e,s,t,n)=>m(void 0,null,function*(){let i=e.component;if(!i)throw new Error("cant createRefComponent with detached ref");return new Promise((o,a)=>m(void 0,null,function*(){let l=new J(s.type,i,n);t.push(l),yield i.initiated();let d=setTimeout(()=>{a("timeout")},5e3);i.send(new pe(e.refConfig,s,H(f({},n||{}),{id:l.id,_hasParent:!0}),c=>m(void 0,null,function*(){if(clearTimeout(d),c.failed){a("CreateRefComponentMessage failed");return}let u=t.find(p=>p.id==l.id);if(u!==l){i.refs[e.refConfig.name]=u,o(u);return}else l.setInitiated(),i.refs[e.refConfig.name]=l;c.nestedRefs.forEach(p=>{let y=s.instance.resolvedNestedComponents.find(S=>S.type.id===p.componentDefinitionId).type,C=new J(y,l);C.setInitiated(),l.refs[p.refName]=C,t.push(C)});try{yield Se(l,s,t,!0),i.setHeightBasedOnScrollHeight&&i.setHeightBasedOnScrollHeight(),o(l)}catch(p){a(p)}})))}))}),Se=(e,s,t,n=!1)=>m(void 0,null,function*(){e.refs||(e.refs={});let i=Object.values(e.componentDefinition.refs).map(o=>new Promise((a,l)=>m(void 0,null,function*(){var d;if(o.behavior.type==G.component){if(n){a();return}let c=o.behavior.componentId;c||(c=o.behavior.instance.componentId);let u=(d=s.instance.resolvedNestedComponents)==null?void 0:d.find(y=>y.type.id===c);if(!u)throw new Error("componentConfig provided without nestedComponentConfig check the config object");let p=R.create("",o,e);try{let y=yield xe(p,u,t);e.refs[o.name]=y,a()}catch(y){l(y)}}else try{let c=R.create("",o,e);e.refs[o.name]=ut(c,e),a()}catch{}})));try{yield Promise.all(i)}catch(o){throw o}}),Ot=e=>m(void 0,null,function*(){return yield e()}),Lt=e=>e,ht=class extends W{constructor(e,s,t,n,i){super(e,t,i),this.componentConfig=e,this.container=t,this.IframeElement=n,r(this,"cleanupInspect"),r(this,"setHeightBasedOnDocumentElement",()=>{let o=this.send(new x(()=>window.document.documentElement.scrollHeight,a=>{this.IframeElement.style.height=`${a.content}px`,o()}))}),r(this,"setHeightBasedOnScrollHeight",()=>{let o=this.send(new x(()=>{let l=0;return l++,l--,Math.max(Math.max(window.document.body.clientHeight,window.document.body.scrollHeight),window.document.body.offsetHeight)+l+"px"},a=>{this.IframeElement.style.height=a.content,o()}))}),r(this,"send",o=>{var a,l;let d=f({},o);if(d.messageType===h.ExecuteComponentMethod)return this[d.method](),()=>{};d.direction=v.down;let c=super.send(d);return(l=(a=this.IframeElement)==null?void 0:a.contentWindow)==null||l.postMessage(d,"*"),c}),r(this,"dispose",()=>{this.cleanupInspect&&this.cleanupInspect(),super.dispose(),this.IframeElement.parentNode.removeChild(this.IframeElement)}),s.loader.autoHeight&&this.initiated().then(()=>{this.setHeightBasedOnScrollHeight()}),this.element=this.IframeElement}inspect(){return this.cleanupInspect?this.cleanupInspect:(this.cleanupInspect=Ie(this.id,"MyopIframeComponent",10,this.container,this.IframeElement,this.componentDefinition),()=>{this.cleanupInspect(),this.cleanupInspect=void 0})}hide(){this.IframeElement.style.opacity="0",this.IframeElement.style.position="absolute",this.IframeElement.style.pointerEvents="none",this.IframeElement.style.visibility="hidden"}show(){this.IframeElement.style.opacity="1",this.IframeElement.style.position="unset",this.IframeElement.style.pointerEvents="all",this.IframeElement.style.visibility="visible"}onMessageReceived(e){return e.messageType===h.In.MutationObserverMessage||e.messageType===h.In.ResizeObserverMessage?(this.setHeightBasedOnScrollHeight(),!0):super.onMessageReceived(e)}},V=class{constructor(){r(this,"appendChild",(e,s,t)=>{var n;if(t?.relative){if(t.relative.direction==="before")return e.insertBefore(s,t.relative.child);if(t.relative.direction==="after"){let i=(n=t.relative.child)==null?void 0:n.nextSibling;return e.insertBefore(s,i||null)}}else return e.appendChild(s)})}},pt=(e,s,t)=>{let n=new URL(e);return n.searchParams.append(s,t),n.toString()},mt=class extends V{constructor(){super(...arguments),r(this,"type",U.IframeLoader),r(this,"load",(e,s,t,n)=>m(this,null,function*(){let i,o=s.loader;if(t?.nodeName==="IFRAME")console.log("needs to load into an exsisting Iframe...",o.url,t),i=t,i.src=o.url;else{let a=_(),l=`myop-comp-${a}`;i=document.createElement("iframe"),t.querySelector('[id^="myop-comp-"]')||(t.innerHTML=""),n?.hidden&&(i.style.visibility="hidden"),i=this.appendChild(t,i,n);let d=s.loader.url;n?._hasParent&&(d=pt(d,"_myop-comp",a)),i.outerHTML=`<iframe 
               id="${l}"
               style="
                   padding: 0;
                   margin: 0;
                   height: ${o.autoHeight||!o.height?"":o.height};    
                   width : 100%;
                   overflow: hidden;
                   border: none;
                   opacity: ${n?.hidden?"0":"1"};
                   position: ${n?.hidden?"absolute":"static"};
                   pointer-events: ${n?.hidden?"none":"all"};
               "
            src="${d}"></iframe>`,i=t.querySelector(`#${l}`)}return new ht(e,s,t,i,n)}))}},Re={webcomponent_message_key:"myop_webcomponent_message"},Te=class extends W{constructor(e,s,t,n,i){super(e,t,i),this.container=t,this.customElement=n,r(this,"cleanupInspect",()=>{}),r(this,"send",o=>{let a=f({},o),l=super.send(a),d=new CustomEvent(Re.webcomponent_message_key,{detail:a});try{this.customElement.dispatchEvent(d)}catch(c){console.log("error while trying to dispatchEvent",c)}return l}),r(this,"dispose",()=>{var o;super.dispose(),(o=this.customElement.parentNode)==null||o.removeChild(this.customElement)}),this.element=n}inspect(){return this.cleanupInspect=Ie(this.id,"MyopWebComponent",0,this.container,this.customElement,this.componentDefinition),this.cleanupInspect}hide(){this.customElement.style.opacity="0",this.customElement.style.position="absolute",this.customElement.style.pointerEvents="none",this.customElement.style.visibility="hidden",this.customElement.style.height="0",this.customElement.style.width="0"}show(){this.customElement.style.opacity="1",this.customElement.style.position="unset",this.customElement.style.pointerEvents="all",this.customElement.style.visibility="visible",this.customElement.style.height="",this.customElement.style.width=""}},A={},ft=class extends V{constructor(){super(...arguments),r(this,"type",U.WebComponentLoader),r(this,"load",(e,s,t,n)=>m(this,null,function*(){let i=s.loader;A[i.url]?console.log("Module alreday loaded or in loading process"):A[i.url]=new Promise((l,d)=>{let c=i.url,u=document.createElement("script");u.type="module",u.src=c,u.onload=()=>{l()},u.onerror=()=>{d()},document.head.appendChild(u)}),yield A[i.url],yield Ae(1);let o=`myop-comp-${_()}`,a=document.createElement(i.tag);return t.querySelector('[id^="myop-comp-"]')||(t.innerHTML=""),a.id=o,n?.hidden&&(a.style.opacity="0",a.style.position="absolute",a.style.height="0",a.style.width="0",a.style.pointerEvents="none",a.style.visibility="hidden"),this.appendChild(t,a,n),new Te(e,s,t,a,n)}))}},gt="0.1.16",b=class extends st{constructor(e,s){super(e),this.context=s,r(this,"executor",t=>{if(t.destination){let n=t.destination;if(this.context[n].context){let i=(o,a)=>{this.messageToHost(H(f({},o),{source:t.destination?t.destination:t.source,destination:t.source?t.source:t.destination}),a)};return this.innerExecutor(t,this.context[n].context,i)}else debugger}else debugger})}},T={id:"myop-id"},D=(e,s)=>s.querySelectorAll(`[${T.id}='${e.refConfig.selector}']`),yt=class extends b{constructor(){super(...arguments),r(this,"messageType",h.BindClickMessage),r(this,"innerExecutor",(e,s,t)=>{let n=D(e.ref,s.shadowRoot),i=[];return n.forEach(o=>{let a=()=>{t(new se(e.handlerUniqueId))};o.addEventListener("click",a),i.push(()=>{o.removeEventListener("click",a)})}),()=>{i.forEach(o=>o())}})}},vt=class extends b{constructor(){super(...arguments),r(this,"messageType",h.ChangeTextMessage),r(this,"innerExecutor",(e,s)=>{D(e.ref,s.shadowRoot).forEach(n=>{n.textContent=e.content})})}},Mt=class extends ot{constructor(e,s){super(e,s),this.container=e,this.shadowRoot=s}},wt=class extends b{constructor(){super(...arguments),r(this,"innerExecutor",(e,s)=>{let t=s.shadowRoot.querySelectorAll(`[${T.id}]`),n=[];t.forEach(i=>{let o=i.getAttribute(T.id);o&&n.push(new Ye(o,i.tagName,i.getBoundingClientRect(),i.offsetTop,i.offsetLeft))}),this.messageToHost(new ge(e.handlerUniqueId,n))}),r(this,"messageType",h.DetectMyopRefsMessage)}},Et=class extends b{constructor(){super(...arguments),r(this,"messageType",h.SetAttributeMessage),r(this,"innerExecutor",(e,s)=>{D(e.ref,s.shadowRoot).forEach(n=>{n.setAttribute(e.name,e.value)})})}},bt=class extends b{constructor(){super(...arguments),r(this,"messageType",h.AddEventListenerMessage),r(this,"innerExecutor",(e,s,t)=>{let n=D(e.ref,s.shadowRoot),i=[];return n.forEach(o=>{let a=l=>{t(new ae(e.handlerUniqueId,I(l,e.serializableSkeleton)))};o.addEventListener(e.type,a),i.push(()=>{o.removeEventListener(e.type,a)})}),()=>{i.forEach(o=>o())}})}},Ct=class extends b{constructor(){super(...arguments),r(this,"messageType",h.CreateRefComponentMessage),r(this,"innerExecutor",(e,s,t)=>{m(this,null,function*(){let i=s.shadowRoot.querySelectorAll(`[${T.id}='${e.refConfig.selector}']`);if(i.length===1){let o=P.Instance(),a=o.components.find(u=>u.id===e.options.id);a&&a.dispose();let l=o.components.indexOf(a);l!==-1&&o.components.splice(l,1);let d=yield o.loadComponent(e.nestedComponentConfig,i.item(0),e.options),c=[];Object.keys(d.refs).forEach(u=>{let p=d.refs[u];p=p.__nonProxied||p,p.componentDefinition&&c.push({refName:u,componentDefinitionId:p.componentDefinition.id})}),t(new q(e.handlerUniqueId,c))}else{console.error("CreateRefComponentMessageHandler - DOM element not found"),this.messageToHost(new q(e.handlerUniqueId,[],!0));debugger}}).then()})}},It=(e,s,t)=>{let n=e.scriptInputs?e.scriptInputs:{};n.makeSerializable=I,n.send=s,n.rootRef=t,n.__scriptInputs=n;let o=new Function(`return (${e.script})(...arguments)`)(n);s(o)},xt=class extends b{constructor(){super(...arguments),r(this,"messageType",h.ExecuteScriptMessage),r(this,"innerExecutor",(e,s,t)=>{It(e,i=>{t(new re(e.handlerUniqueId,i))},s)})}},He=e=>{if(!e)return null;if(e.tagName==="FORM"){let s=new FormData(e),t={formData:{},unmappedData:[]},n=e.querySelectorAll("input, select, textarea"),i=-1;return n.forEach(o=>{if(typeof o.value=="string"){let a=o.getAttribute(T.id),l=o.getAttribute("name"),d={id:o.id,name:l,value:He(o),required:o.required,validity:I(o.validity,!0),myopId:a};l?t.formData[l]?t.formData[l].value?t.unmappedData.push(d):(t.unmappedData.push(t.formData[l]),t.formData[l]=d):t.formData[l]=d:t.unmappedData.push(d)}}),t}return e.type==="checkbox"||e.type==="radio"?e.checked?e.value:null:e.tagName==="INPUT"||e.tagName==="TEXTAREA"||e.tagName==="SELECT"?e.value:e.isContentEditable?e.innerText||e.textContent:null},St=class extends b{constructor(){super(...arguments),r(this,"messageType",h.GetElementValueMessage),r(this,"innerExecutor",(e,s,t)=>{D(e.ref,s.shadowRoot).forEach(i=>{t(new de(He(i)),e)})})}},_e=class extends it{constructor(){super(...arguments),r(this,"alwaysPassEnvelopesToHost",!0),r(this,"connectedCallback",(e,s)=>{e.addEventListener(Re.webcomponent_message_key,t=>{let n=t.data?t.data:t.detail;if(!n||!n.myop){debugger;throw new Error("recvied webcomponent_message with wrong type")}else{let i=n;if(this.handleIncomeMessages(t),i.messageType===h.InitMessage){let o=i.content.id;this.components[o].context=new Mt(e,s)}}}),setTimeout(()=>{this.messageToHost(new ue)},1)}),r(this,"messageToHost",(e,s)=>{e.direction=v.up,!e.replayToHandler&&s?.handlerUniqueId&&(e.replayToHandler=s.handlerUniqueId),window.myop.hostSDK.send(e)}),r(this,"supportedHandlers",[new vt(this.messageToHost,this.components),new yt(this.messageToHost,this.components),new wt(this.messageToHost,this.components),new Et(this.messageToHost,this.components),new bt(this.messageToHost,this.components),new xt(this.messageToHost,this.components),new St(this.messageToHost,this.components),new Ct(this.messageToHost,this.components)]),r(this,"init",()=>{})}};Y("WebComponentSDK",_e);var Q=[],O,De=()=>m(void 0,null,function*(){return O||(O=new _e,O.init()),O});function Rt(e,s){return class extends HTMLElement{connectedCallback(){let t=s===be.open?"open":"closed",n=this.attachShadow({mode:t});De().then(i=>{i.connectedCallback(this,n),n.innerHTML=e})}constructor(){super()}}}var Tt=(e,s,t)=>{customElements.define(e,Rt(s,t)),console.log(`define('${e}') was called, web component ready to use`)},Ht=e=>e.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/(\d+)/g,"-$1").toLowerCase(),_t=e=>(e=Ht(e),e.replace(/_/g,"-")),L,Dt=class extends V{constructor(){super(...arguments),r(this,"type",U.HTMLLoader),r(this,"load",(e,s,t,n)=>m(this,null,function*(){let i=s.loader,o=`myop-comp-${_()}`,a;if(i.shadowRootMode===be.none)L=L||new DOMParser,a=L.parseFromString(i.HTML,"text/html").body.firstChild,De().then(d=>{d.connectedCallback(a,a)});else{let l=_t(e.name+s.id);Q.includes(l)||(Tt(l,i.HTML,i.shadowRootMode),Q.push(l)),a=document.createElement(l)}return t.querySelector('[id^="myop-comp-"]')||(t.innerHTML=""),a.id=o,n?.hidden&&(a.style.opacity="0",a.style.position="absolute",a.style.height="0",a.style.width="0",a.style.pointerEvents="none",a.style.visibility="hidden"),this.appendChild(t,a,n),new Te(e,s,t,a,n)}))}},P=class{constructor(){r(this,"components2init",[]),r(this,"components",[]),r(this,"componentsLoaders",[]),r(this,"initiated",!1),r(this,"version",gt),r(this,"type2InstanceCount",{}),r(this,"assignId",e=>(this.type2InstanceCount[e.id]||(this.type2InstanceCount[e.id]=0),`${e.name}_${++this.type2InstanceCount[e.id]}`)),r(this,"inspected",!1),r(this,"inspect",()=>{this.inspected||(this.inspected=!0,this.components.forEach(e=>{e.inspect&&e.inspect()}))}),r(this,"incomingMessageHandler",e=>{if(e.origin,document.location.origin,e.data.myop){if(e.data.direction!==v.up&&e.data.messageType!==h.EnvelopedMessage)return;let s=e.data;if(s.messageType===h.InitRequest){this.components2init.forEach(n=>{n.send(new N(n.id))});return}if(s.messageType===h.InitResponse){this.components2init=this.components2init.filter(i=>i.id!==s.content.id);let n=this.components.find(i=>{var o;return i.id===((o=s.content)==null?void 0:o.id)});n?.setInitiated();return}if(s.messageType===h.EnvelopedMessage){let n=s,i=this.components.find(o=>o.id===n.destination);if(i){if(n.direction===v.down){n.message.messageType===E.name?i.onMessageReceived(n.message):(n.message.route=n.route,i.send(n.message));return}}else{let o=this.components.find(a=>a.id===n.message.destination);o&&o.send(n.message)}return}let t=this.components.find(n=>n.id===s.destination);if(!t){window.myop.IframeSDK&&window.myop.IframeSDK.messageToHost(s);return}if(t){if(t.onMessageReceived(s))return;window.myop.IframeSDK&&window.myop.IframeSDK.messageToHost(s)}}}),r(this,"send",e=>{let s=new MessageEvent("",{data:e});this.incomingMessageHandler(s)}),r(this,"init",e=>{if(this.initiated)throw new Error("hostSDK already initiated");let s=[new mt,new ft,new Dt];if(this.componentsLoaders=[...s],e){let t={};e.forEach(n=>{let i=new n(this.componentsLoaders);t[i.type]=i}),this.componentsLoaders.forEach(n=>{t[n.type]||(t[n.type]=n)}),this.componentsLoaders=Object.values(t)}window.addEventListener("message",this.incomingMessageHandler,!1),console.log("myop hostSDK initiated",document.location.href),this.initiated=!0}),r(this,"_getSkinIdBySkinSelector",(e,...s)=>m(this,[e,...s],function*(t,n=[],i){var o;function a(l,d){return m(this,null,function*(){for(let c of l)if(yield d(c))return c})}switch(t.type){case"DedicatedSkin":case $.Dedicated:return((o=t.skin)==null?void 0:o.id)||t.skins[0].id;case $.Segmented:{let d=yield a(t.segments,c=>m(this,null,function*(){if(c.segmentId==="Default")return!0;let u=n.find(S=>S.type===rt.Segment?S.segment.id===c.segmentId:!1);if(!u)throw new Error("experience not found");let y=u.segment,C=(i||{})[y.function];return C?yield C():(console.warn(`segmentId:${c.segmentId}, ${y.function} function not provided !`),!1)}));if(d)return this._getSkinIdBySkinSelector(d.skinSelector,n);debugger}break;default:debugger}return""})),r(this,"runSkinSelector",(e,s)=>m(this,null,function*(){let t=yield this._getSkinIdBySkinSelector(e.instance.skinSelector,e.instance.resolvedExperiences,s);return e.type.skins.find(n=>n.id===t)})),r(this,"loadComponent",(e,s,t)=>m(this,null,function*(){var n,i;if(!s){debugger;throw new Error("no container was found for this component")}let o=s;if(o.myop)if(o.component){e=f({},e),e.instance=f({},e.instance);let c=yield this.runSkinSelector(e,t?.hooks);if(!c)throw new Error("runSkinSelector failed to choose skin, check the provided config");return(n=t?.hooks)!=null&&n.afterSkinSelected&&(c=yield t.hooks.afterSkinSelected(f({},c))),e.instance.skinSelector={type:$.Dedicated,skin:c},t&&(t=f({},t),delete t.hooks),yield xe(o,e,this.components,t)}else throw new Error("load component got a detached ref.");s=s;let a=yield this.runSkinSelector(e,t?.hooks);if(!a)throw new Error("runSkinSelector failed to choose skin, check the provided config");(i=t?.hooks)!=null&&i.afterSkinSelected&&(a=yield t.hooks.afterSkinSelected(f({},a)));let l=this.componentsLoaders.find(c=>c.type===a.loader.type);if(!l){debugger;throw new Error(`no loader "${a.loader.type}" was found for component`)}let d=yield l.load(e.type,a,s,t);d.isInitiated||this.components2init.push(d),d.bind("onDispose",()=>(this.components=this.components.filter(c=>c!==d),this.components2init=this.components2init.filter(c=>c!==d),!0)),this.components.push(d),t?.connectProps&&(d=ct(d,e.type.props));try{yield Se(d,e,this.components)}catch(c){throw c}return t?.skipInit||(yield d.initiated()),d})),r(this,"navigate",(e,s,t)=>m(this,null,function*(){if(e.parent)throw new Error("Navigating on remote ref components is not implemented yet");if(t?.staged){let n=yield this.loadComponent(s,e.container,f({hidden:!0,relative:{direction:"after",child:e.element}},t));return t.init&&(yield t.init(n)),n.show(),e.dispose(),n}else{let n=e.element.nextSibling;return e.dispose(),this.loadComponent(s,e.container,f({relative:{direction:"before",child:n}},t))}}))}};r(P,"Instance",()=>window.myop.hostSDK);window.myop||(window.myop={});if(!window.myop.hostSDK){let e=new P;e.init(),window.myop||(window.myop={}),window.myop.hostSDK=e}var kt=window.myop.hostSDK;Y("hostSDK",kt);export{W as BaseMyopComponent,V as BaseMyopLoader,Lt as actAs,ct as connectProps,Se as connectRefs,xe as createRefComponent,ut as createRefProxy,Ot as exec,kt as hostSDK,Ie as setDebugStyle};
